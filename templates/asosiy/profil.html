{% extends 'asosiy/base.html' %}
{% load static %}

{% block content %}
<section class="section profile-section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Profil ma'lumotlari</h2>
            <p class="section-subtitle">Shaxsiy ma'lumotlaringizni yangilang</p>
        </div>

        <div class="profile-wrapper">
            <div class="profile-sidebar">
                <div class="profile-image">
                    <img src="{{ user.profil_rasmi.url }}" alt="{{ user.get_full_name }}">
                    <form method="post" action="{% url 'profil' %}" enctype="multipart/form-data" class="image-upload-form">
                        {% csrf_token %}
                        <input type="file" name="profil_rasmi" id="profile-image-input" accept="image/*">
                        <label for="profile-image-input" class="btn btn-small">Rasmni almashtirish</label>
                    </form>
                </div>
                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-number">{{ user.qabullar.count }}</span>
                        <span class="stat-text">Qabullar</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">{{ user.sharhlar.count }}</span>
                        <span class="stat-text">Sharhlar</span>
                    </div>
                </div>
            </div>
            
            <div class="profile-content">
                <form method="post" enctype="multipart/form-data" class="profile-form">
                    {% csrf_token %}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.first_name.id_for_label }}">Ism</label>
                            {{ form.first_name }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.last_name.id_for_label }}">Familiya</label>
                            {{ form.last_name }}
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.email.id_for_label }}">Elektron pochta</label>
                            {{ form.email }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.tugilgan_sana.id_for_label }}">Tug'ilgan sana</label>
                            {{ form.tugilgan_sana }}
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.telefon_kodi.id_for_label }}">Telefon kodi</label>
                            {{ form.telefon_kodi }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.telefon.id_for_label }}">Telefon raqam</label>
                            {{ form.telefon }}
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.jins.id_for_label }}">Jins</label>
                            {{ form.jins }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.manzil.id_for_label }}">Manzil</label>
                            {{ form.manzil }}
                        </div>
                    </div>
                    
                    {% if form.errors %}
                    <div class="form-errors">
                        {% for field in form %}
                            {% for error in field.errors %}
                                <p class="error">{{ error }}</p>
                            {% endfor %}
                        {% endfor %}
                        {% for error in form.non_field_errors %}
                            <p class="error">{{ error }}</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Saqlash</button>
                        <a href="{% url 'bosh' %}" class="btn btn-outline">Bekor qilish</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Profil rasmini yuklash
    const imageInput = document.getElementById('profile-image-input');
    if (imageInput) {
        imageInput.addEventListener('change', function() {
            this.form.submit();
        });
    }
});
</script>
{% endblock %}